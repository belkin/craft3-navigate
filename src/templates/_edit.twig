{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Navigate plugin for Craft CMS 3.x
 *
 * Navigate index.twig
 *
 * @author    Studio Espresso
 * @copyright Copyright (c) 2018 Studio Espresso
 * @link      https://studioespresso.co
 * @package   Navigate
 * @since     0.0.1
 */
#}

{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("studioespresso\\navigate\\assetbundles\\navigate\\NavigateAsset") %}

{# Link for the ? icon at the bottom of the page #}
{% set docsUrl = "https://github.com/studioespresso/navigate/blob/master/README.md" %}

{# The title of this CP section #}
{% set pluginTitle = 'Navigate' %}
{% set title = navigation.title is defined ? navigation.title : 'New navigation' %}

{% set fullPageForm = true %}

{% set crumbs = [
    { label: pluginTitle, url: url('navigate') },
    { label: 'Edit', url: '#' }
]
%}

{% block header %}
    {% block pageTitle %}
        {% if title is defined and title|length %}
            <h1>{{ title }}</h1>
        {% endif %}
        <input name="action" type="hidden" action="{{ actionUrl('navigate/nodes/save') }}">
    {% endblock %}
    {% block contextMenu %}{% endblock %}
    <div class="flex-grow"></div>
    {% block actionButton %}
        {% if fullPageForm %}
            <input type="submit" class="btn submit" value="{{ 'Save navigation'|t('navigate') }}">
        {% endif %}
    {% endblock %}
{% endblock %}

{# The content of the CP Section#}
{% block content %}
<div id="navigate-nodes-input">
    {% if not nodes|length %}
        <p>{{ 'Use to buttons below to start adding items to your navigation'|t('navigate') }}</p>
    {% endif %}
    <div class="blocks">
        {% set totalNewBlocks = 0 %}
        {% for node in nodes%}
            {% set nodeId = node.id %}
            {% if not nodeId %}
                {% set totalNewNodes = totalNewNodes+ 1 %}
                {% set nodeId = 'new'~totalNewNodes %}
                {% set nodeId = 'new'~totalNewNodes %}
            {% endif %}

            <div class="matrixblock{% if not node.enabled %} disabled{% endif %}" data-id="{{ nodeId }}"{% if node.collapsed %} data-collapsed{% endif %} data-type="{# TODO #}">
                {% if not static %}
                    <input type="hidden" name="{{ name }}[{{ blockId }}][type]" value="{{ block.getType().handle }}">
                    <input type="hidden" name="{{ name }}[{{ blockId }}][enabled]" value="{% if block.enabled %}1{% endif %}">
                    <div class="titlebar">
                        <div class="blocktype">{{ block.getType().name|t('site') }}</div>
                        <div class="preview"></div>
                    </div>
                    <div class="checkbox" title="{{ 'Select'|t('app') }}"></div>
                    <div class="actions">
                        <div class="status off" title="{{ 'Disabled'|t('app') }}"></div>
                        <a class="settings icon menubtn" title="{{ 'Actions'|t('app') }}" role="button"></a>
                        <div class="menu">
                            <ul class="padded">
                                <li><a data-icon="collapse" data-action="collapse">{{ "Collapse"|t('app') }}</a></li>
                                <li class="hidden"><a data-icon="expand" data-action="expand">{{ "Expand"|t('app') }}</a></li>
                                <li{% if not block.enabled %} class="hidden"{% endif %}><a data-icon="disabled" data-action="disable">{{ "Disable"|t('app') }}</a></li>
                                <li{% if block.enabled %} class="hidden"{% endif %}><a data-icon="enabled" data-action="enable">{{ "Enable"|t('app') }}</a></li>
                            </ul>
                            {% if not staticBlocks %}
                                <hr class="padded">
                                <ul class="padded">
                                    <li><a class="error" data-icon="remove" data-action="delete">{{ "Delete"|t('app') }}</a></li>
                                </ul>
                                <hr class="padded">
                                <ul class="padded">
                                    {% for blockType in blockTypes %}
                                        <li><a data-icon="plus" data-action="add" data-type="{{ blockType.handle }}">{{ "Add {type} above"|t('app', { type: blockType.name|t('site') }) }}</a></li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                        <a class="move icon" title="{{ 'Reorder'|t('app') }}" role="button"></a>
                    </div>
                {% endif %}
                <div class="fields">
                </div>
            </div>
        {% endfor %}
    </div>
    <div class="buttons">
        <div class="btngroup">
            {% for nodeType in nodeTypes%}
                <div class="btn{% if loop.first %} add icon{% endif %}" data-type="{{ nodeType.handle }}">{{ nodeType.title|t('navigate') }}</div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block details %}
    <div id="details">
        <div id="settings" class="meta">

            <div class="field" id="slug-field">
                <div class="heading">
                    <label id="handle-label" for="handle">Handle</label>
                </div>
                <div class="input ltr">
                    <input class="text fullwidth" disabled="disabled" type="text" id="handle" name="handle" value="{{ navigation.handle }}" autocomplete="off">
                </div>
            </div>

        </div>
    </div>
{% endblock %}